#!/bin/bash

dir_logs="/var/log"
keep_log=7
backup_logs=30
dir_backup="$HOME/backuplogs"


while true; do
    
    #Escolha do Usuario
    echo "1. Definir diretório para os logs (padrão: /var/log)"
    echo "2. Definir quantidade de dias para manter os logs (padrão: 7 dias)"
    echo "3. Definir quantidade de dias para manter os backups (padrão: 30 dias)"
    echo "4. Definir diretório para armazenar os backups (padrão: $HOME/backuplogs)"
    echo "5. Executar backup dos logs agora"
    echo "6. Sair"
    echo ""

    read -r -p "Escolha Uma Opção [1-6]: " escolha

    case $escolha in

        1)
            read -r -p "Digite o diretório onde estão armazenados os logs: " dir_logs
            if [ ! -d "$dir_logs" ]; then
                echo "Esse diretório $dir_logs não existe."
                echo "Voltando para o padrão: /var/log"
                dir_logs="/var/log"
            else
                echo "Diretório atualizado para $dir_logs"
            fi
            ;;
        2)
            read -r -p "Definir quantidade de dias para manter os logs (recomendado: 7 dias): " keep_log
            echo "Dias para manter os logs atualizado para $keep_log"
            ;;

        3)
            read -r -p "Definir quantidade de dias para backup dos logs (recomendado: 30 dias): " backup_logs
            echo "Dias para manter os backups atualizado para $backup_logs"
            ;;
        4)
            read -r -p "Digite o diretório onde serão armazenados os backups: " dir_backup
            echo "Diretório de backup atualizado para $dir_backup"
            ;;
        5)
            #Execução do Script
            #find [path] [options] [expression]
            
            echo "Vamos começar o Script..."

            sudo find "$dir_logs" -type f -mtime +$backup_logs -exec rm -f {} \;            
            sleep 5
            
            # Criar diretório de backup, se não existir
            mkdir -p "$dir_backup"            
            
            sudo log_files=$(find "$dir_logs" -type f -mtime +$keep_log)

            if [ -n "$log_files" ]; then
                sudo tar -czvf "$dir_backup/logs_$(date +%d%m%Y).tar.gz" $log_files
                echo "Backup criado com sucesso!"
            else
                echo "Nenhum arquivo de log antigo para compactar."
            fi
            ;;
        6)
            echo "Saindo..."
            break
            ;;
        *)
            echo "Opção inválida. Por favor, escolha uma opção de 1 a 6."
            ;;
    esac
done
